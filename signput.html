<!DOCTYPE HTML>
<!--
	Phantom by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>

<head>
    <title>정보 수정</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />

    <!-- CSS -->
    <link rel="stylesheet" href="./assets/css/sign/sign_up.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <link rel="stylesheet" href="./assets/css/sign/signup_main.css" />
    <noscript>
        <link rel="stylesheet" href="./assets/css/noscript.css" />
    </noscript>

    <!-- JS -->
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous">
        </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        async function handle_signput() {
    var token = localStorage.getItem("access")
    if (localStorage.getItem("payload") != null) {
        const payload = JSON.parse(localStorage.getItem("payload"));
        user_id = payload.user_id;
    }

    const input_img = document.getElementById("input_img").files[0]
    const location = document.getElementById("locations").innerText
    const introduction = document.getElementById("introduction").value
    const prefer = document.getElementById("prefer").value

    const signputData = new FormData();

    signputData.append('img', input_img);
    signputData.append("location", XSSCheck(location, 1));
    signputData.append("introduction", XSSCheck(introduction, 1));
    signputData.append("prefer", XSSCheck(prefer, 1));
    
    $.ajax({
        type: "PUT",
        url: "https://rbgud.shop/article/farmer/" + user_id +"/",
        beforeSend: function (xhr) {
          xhr.setRequestHeader("Authorization", "Bearer " + token);
        },
        data: signputData,
        cache: false,
        contentType: false,
        processData: false,
        success: function () {
            const payload = JSON.parse(localStorage.getItem("payload"));
            alert("수정사항이 정상적으로 저장되었습니다.")
            if (payload != null) {
                const user_category = payload.category;
                if (user_category == 1) {
                    window.location.replace(`http://127.0.0.1:5500/farm.html`);
                } else {
                    window.location.replace(`http://127.0.0.1:5500/farmer.html`);
                }
            }
        },
        error:function(){
            alert("수정 실패")
        }
    })
}
    </script>
</head>

<body class="is-preload">
    <!-- Wrapper -->
    <div id="wrapper">

        <!-- Header -->
        <header id="header">
            <div class="inner">

                <!-- Logo -->
                <a href="index.html" class="logo">
                    <span class="symbol"><img src="./images/first_farm_logo.png" alt="" /></span><span
                        class="title">FristFarm</span>
                </a>

                <!-- Nav -->
                <nav>
                    <ul>
                        <li><a href="#menu">Menu</a></li>
                    </ul>
                </nav>

            </div>
        </header>

        <!-- Menu -->
        <nav id="menu">
            <h2>Menu</h2>
            <ul>
                <li><a href="index.html">소개</a></li>
                <li><a href="search_article.html">알바 / 체험 찾기</a></li>
                <li><a href="articleupload.html" id="a_article">공고 등록</a></li>
            </ul>
<ul><br></ul>
<ul><br></ul>
<ul><br></ul>
<ul><br></ul>
<ul><br></ul>
<ul><br></ul>
<ul><br></ul>
<ul><br></ul>
<ul><br></ul>
<ul><br></ul>
<ul><br></ul>
<ul><br></ul>
<ul><br></ul>
<ul><br></ul>
            <ul>
                <li class="btn_hover">
                    <a id="a_mypage" class="link" onclick="handle_enter_mypage()">
                        마이페이지
                    </a>
                </li>
                <li class="btn_hover">
                    <a id="a_logout" class="nav-logout" onclick="handle_logout()">
                        로그아웃
                    </a>
                </li>
                <li class="btn_hover">
                    <a id="a_login" class="nav-signin" href="signin.html">
                        로그인
                    </a>
                </li>
                <li class="btn_hover">
                    <a id="a_signup" class="nav-signup" href="signup.html">
                        회원가입
                    </a>
                </li>
            </ul>
            </nav>
        </nav>

        <!-- Main -->
        <div id="main" style="height:100%">
            <div class="inner">
                <!-- content-->
                <div id="content">
                    <div id="content_box">
                            <!-- header_1 -->
                            <div id="header_2">
                                <div class="waviy">
                                    <span style="--i:1">정</span>
                                    <span style="--i:2">보</span>
                                    <span style="--i:3">수</span>
                                    <span style="--i:4">정</span>
                                </div>
                            </div>
                            <!-- PICTURE -->
                            <h3 class="join_title"><label for="">프로필 사진</label></h3>
                            <div class="box_container">
                                <div class="box_img">
                                    <img id="default_img" class="int_img"
                                        src="./images/style_sign_in_up_images/form_profile_img.png" type="file">
                                </div>
                                <div class="img_btn_container">
                                    <input style="display: none;" id="input_img" class="img_find" type="file"
                                        accept="image/jpeg, image/jpg, image/png">
                                    <div id="btnJoin_img" class="upload">사진 변경</div>
                                    <span id="btnJoin_img_span" >(150px * 150px)</span>
                                </div>
                            </div>
                            <!-- LOCATION -->
                            <div class="input_form">
                                <h3 class="join_title"><label for="locations">* 지역</label></h3>
                                <button class="location_find" id="btnJoin_location" type="button"
                                    onclick="serch_loaction()" value="주소 찾기"><span>주소
                                        찾기</span></button><br>
                                <span class="box" style="margin: auto;">
                                    <span class="int" type="text" id="locations" placeholder="주소"
                                        style="display: flex; align-items: center;"></span>
                                </span>
                            </div>

                            <!-- INTRODUCTION -->
                            <div class="input_form">
                                <h3 class="join_title"><label for="introduction">자기소개</label> <span
                                        style="font-size: 11px; color:rgb(119, 119, 119)">(최대 400자 제한)</span></h3>
                                <span class="box int_name" style="height: 200px;">
                                    <textarea type="textarea" id="introduction" class="int" maxlength=400"
                                        style="height: 170px; padding-top: 2px; word-break:break-all; resize: none;"
                                        placeholder="간단하게 자신을 소개해 주세요."></textarea>
                                </span>
                            </div>
                            <!-- PREFER -->
                            <div class="input_form">
                                <h3 class="join_title"><label for="prefer">* 선호</label></h3>
                                <span class="box int_name">
                                    <input type="text" id="prefer" class="int" maxlength="20"
                                        placeholder="예) 사과, 딸기, 복숭아, 바나나 등">
                                </span>
                                <span class="error_next_box"></span>
                            </div>
                        <!-- JOIN BTN-->
                        <div class="btn_area">
                            <button type="button" id="btnJoin" onclick="handle_signput()">
                                <span>변경하기</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            </div>
        </div>
    

    <!-- Scripts -->
    <script src="./assets/js/jquery.min.js"></script>
    <script src="./assets/js/browser.min.js"></script>
    <script src="./assets/js/breakpoints.min.js"></script>
    <script src="./assets/js/util.js"></script>
    <script src="./assets/js/main.js"></script>

    <script src="./assets/js/sign/sign_put.js"></script>
    <script src="./assets/js/sign/auth.js"></script>
    <script src="./js/nav.js"></script>

</body>

</html>